<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Local Seller</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="global.js"></script><script src="public-config.js"></script><style>body{font-family:Arial;background:#f5f5f5;margin:0}.top{background:#111;color:#fff;padding:12px;font-weight:700}.box{background:#fff;margin:10px;border-radius:12px;padding:12px}.row{border:1px solid #eee;border-radius:10px;padding:10px;margin:8px 0}.btn{border:none;border-radius:8px;padding:8px 10px;background:#ff6a00;color:#fff;cursor:pointer;margin-right:8px}</style></head><body><div class="top">Seller Orders</div><div class="box"><button class="btn" onclick="loadOrders()">Refresh</button><div id="list"></div></div><script>
const supa=window.supa||window.novaCreateSupabaseClient();let me=null;function bases(){const o=[];const p=v=>{v=String(v||'').trim().replace(/\/+$/g,'');if(v&&/^https?:\/\//i.test(v)&&!o.includes(v))o.push(v)};p(window.CONTEST_API_BASE||window.API_BASE||'');try{p(localStorage.getItem('contest_api_base'));p(localStorage.getItem('api_base'))}catch(_){};if(/^https?:\/\//i.test(location.origin||''))p(location.origin);p('https://novagapp-mart.onrender.com');return o}
async function meUser(){if(me)return me;const {data}=await supa.auth.getSession();me=data?.session?.user||null; if(!me){location.href='login.html';return null;} return me;}
async function loadOrders(){const u=await meUser(); if(!u) return; for(const b of bases()){try{const r=await fetch(`${b}/api/local/orders/for-seller?user_id=${encodeURIComponent(u.id)}`);const j=await r.json().catch(()=>null);if(r.ok&&j?.ok){render(j.orders||[]);return}}catch(_){}}}
function render(rows){const box=document.getElementById('list');box.innerHTML=''; if(!rows.length){box.textContent='No orders';return;} rows.forEach(r=>{const d=document.createElement('div');d.className='row';d.innerHTML=`<b>${r.service_type||''}</b> | INR ${Number(r.amount_inr||0).toFixed(2)}<div>${r.delivery_address||''}</div><div>Status: ${r.status||''}</div><button class='btn' onclick="setStatus('${r.id}','accepted')">Accept</button><button class='btn' onclick="setStatus('${r.id}','out_for_delivery')">Out</button><button class='btn' onclick="setStatus('${r.id}','completed')">Done</button>`;box.appendChild(d)})}
async function setStatus(id,status){const u=await meUser(); if(!u)return; for(const b of bases()){try{const r=await fetch(b+'/api/local/orders/status',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({order_id:id,user_id:u.id,status})});const j=await r.json().catch(()=>null);if(r.ok&&j?.ok){loadOrders();return}}catch(_){}}alert('update failed')}
meUser().then(loadOrders);
</script></body></html>
