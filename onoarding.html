<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Welcome | NOVAGAPP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="public-config.js"></script>
<script src="global.js"></script>

<style>
:root{
  --orange:#ff7a00;
  --bg:#0d0f14;
  --card:#151925;
  --text:#fff;
  --muted:#9aa4bf;
}
body{
  margin:0;
  background:var(--bg);
  font-family:Arial,system-ui;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  width:100%;
  max-width:420px;
  background:var(--card);
  padding:28px;
  border-radius:16px;
}
h2{color:var(--text);margin:0 0 8px}
p{color:var(--muted);margin:0 0 20px}
select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  margin-top:12px;
  border:none;
  font-size:15px;
}
select{background:#0f1220;color:#fff}
button{
  background:var(--orange);
  color:#fff;
  font-weight:600;
}
</style>
</head>

<body>

<div class="card">
  <h2 id="title">Welcome</h2>
  <p id="subtitle">Select your country, language & currency</p>

  <select id="lang"></select>
  <select id="currency"></select>
  <select id="country"></select>

  <button onclick="save()">Continue</button>
</div>

<script>
let currentUser = null;

/* ======================
   AUTH CHECK
====================== */
(async ()=>{
  const supabase = window.supa || window.novaCreateSupabaseClient();
  if(!supabase){
    location.href="login.html";
    return;
  }
  const { data } = await supabase.auth.getUser();
  if(!data?.user){
    location.href="login.html";
    return;
  }
  currentUser = data.user;
})();

const langEl = document.getElementById("lang");
const currencyEl = document.getElementById("currency");
const countryEl = document.getElementById("country");

/* ---------- LANGUAGES ---------- */
const globalLanguages = [
  ["en","English"],
  ["zh","Mandarin Chinese"],
  ["es","Spanish"],
  ["ar","Arabic"],
  ["fr","French"],
  ["de","German"],
  ["pt","Portuguese"],
  ["ru","Russian"],
  ["ja","Japanese"],
  ["ko","Korean"],
  ["it","Italian"],
  ["tr","Turkish"],
  ["id","Indonesian"],
  ["th","Thai"],
  ["vi","Vietnamese"]
];

const indianLanguages = [
  ["as","Assamese"],
  ["bn","Bengali"],
  ["brx","Bodo"],
  ["doi","Dogri"],
  ["gu","Gujarati"],
  ["hi","Hindi"],
  ["kn","Kannada"],
  ["ks","Kashmiri"],
  ["kok","Konkani"],
  ["mai","Maithili"],
  ["ml","Malayalam"],
  ["mni","Manipuri (Meitei)"],
  ["mr","Marathi"],
  ["ne","Nepali"],
  ["or","Odia"],
  ["pa","Punjabi"],
  ["sa","Sanskrit"],
  ["sat","Santali"],
  ["sd","Sindhi"],
  ["ta","Tamil"],
  ["te","Telugu"],
  ["ur","Urdu"]
];

function fillLanguages(){
  langEl.innerHTML = "";
  const g1 = document.createElement("optgroup");
  g1.label = "Global Languages";
  globalLanguages.forEach(l=>{
    const o=document.createElement("option");
    o.value=l[0];
    o.textContent=l[1];
    g1.appendChild(o);
  });
  const g2 = document.createElement("optgroup");
  g2.label = "Indian Languages (22 Scheduled)";
  indianLanguages.forEach(l=>{
    const o=document.createElement("option");
    o.value=l[0];
    o.textContent=l[1];
    g2.appendChild(o);
  });
  langEl.appendChild(g1);
  langEl.appendChild(g2);
}

/* ---------- CURRENCIES ---------- */
const currencies = [
  ["USD","US Dollar (USD)"],
  ["EUR","Euro (EUR)"],
  ["GBP","British Pound (GBP)"],
  ["JPY","Japanese Yen (JPY)"],
  ["CNY","Chinese Yuan (CNY)"],
  ["CHF","Swiss Franc (CHF)"],
  ["CAD","Canadian Dollar (CAD)"],
  ["AUD","Australian Dollar (AUD)"],
  ["SGD","Singapore Dollar (SGD)"],
  ["HKD","Hong Kong Dollar (HKD)"],
  ["KRW","South Korean Won (KRW)"],
  ["SAR","Saudi Riyal (SAR)"],
  ["AED","UAE Dirham (AED)"],
  ["NOK","Norwegian Krone (NOK)"],
  ["SEK","Swedish Krona (SEK)"],
  ["INR","Indian Rupee (INR)"]
];

function fillCurrencies(){
  currencyEl.innerHTML = "";
  currencies.forEach(c=>{
    const o=document.createElement("option");
    o.value=c[0];
    o.textContent=c[1];
    currencyEl.appendChild(o);
  });
}

/* ---------- COUNTRIES ---------- */
const countries = [
  ["Afghanistan","üá¶üá´"],
  ["Albania","üá¶üá±"],
  ["Algeria","üá©üáø"],
  ["Andorra","üá¶üá©"],
  ["Angola","üá¶üá¥"],
  ["Antigua and Barbuda","üá¶üá¨"],
  ["Argentina","üá¶üá∑"],
  ["Armenia","üá¶üá≤"],
  ["Australia","üá¶üá∫"],
  ["Austria","üá¶üáπ"],
  ["Azerbaijan","üá¶üáø"],
  ["Bahamas","üáßüá∏"],
  ["Bahrain","üáßüá≠"],
  ["Bangladesh","üáßüá©"],
  ["Barbados","üáßüáß"],
  ["Belarus","üáßüáæ"],
  ["Belgium","üáßüá™"],
  ["Belize","üáßüáø"],
  ["Benin","üáßüáØ"],
  ["Bhutan","üáßüáπ"],
  ["Bolivia","üáßüá¥"],
  ["Bosnia and Herzegovina","üáßüá¶"],
  ["Botswana","üáßüáº"],
  ["Brazil","üáßüá∑"],
  ["Brunei","üáßüá≥"],
  ["Bulgaria","üáßüá¨"],
  ["Burkina Faso","üáßüá´"],
  ["Burundi","üáßüáÆ"],
  ["Cabo Verde","üá®üáª"],
  ["Cambodia","üá∞üá≠"],
  ["Cameroon","üá®üá≤"],
  ["Canada","üá®üá¶"],
  ["Central African Republic","üá®üá´"],
  ["Chad","üáπüá©"],
  ["Chile","üá®üá±"],
  ["China","üá®üá≥"],
  ["Colombia","üá®üá¥"],
  ["Comoros","üá∞üá≤"],
  ["Congo (Congo-Brazzaville)","üá®üá¨"],
  ["Costa Rica","üá®üá∑"],
  ["Croatia","üá≠üá∑"],
  ["Cuba","üá®üá∫"],
  ["Cyprus","üá®üáæ"],
  ["Czechia (Czech Republic)","üá®üáø"],
  ["Democratic Republic of Congo","üá®üá©"],
  ["Denmark","üá©üá∞"],
  ["Djibouti","üá©üáØ"],
  ["Dominica","üá©üá≤"],
  ["Dominican Republic","üá©üá¥"],
  ["Ecuador","üá™üá®"],
  ["Egypt","üá™üá¨"],
  ["El Salvador","üá∏üáª"],
  ["Equatorial Guinea","üá¨üá∂"],
  ["Eritrea","üá™üá∑"],
  ["Estonia","üá™üá™"],
  ["Eswatini","üá∏üáø"],
  ["Ethiopia","üá™üáπ"],
  ["Fiji","üá´üáØ"],
  ["Finland","üá´üáÆ"],
  ["France","üá´üá∑"],
  ["Gabon","üá¨üá¶"],
  ["Gambia","üá¨üá≤"],
  ["Georgia","üá¨üá™"],
  ["Germany","üá©üá™"],
  ["Ghana","üá¨üá≠"],
  ["Greece","üá¨üá∑"],
  ["Grenada","üá¨üá©"],
  ["Guatemala","üá¨üáπ"],
  ["Guinea","üá¨üá≥"],
  ["Guinea-Bissau","üá¨üáº"],
  ["Guyana","üá¨üáæ"],
  ["Haiti","üá≠üáπ"],
  ["Holy See (Vatican City)","üáªüá¶"],
  ["Honduras","üá≠üá≥"],
  ["Hungary","üá≠üá∫"],
  ["Iceland","üáÆüá∏"],
  ["India","üáÆüá≥"],
  ["Indonesia","üáÆüá©"],
  ["Iran","üáÆüá∑"],
  ["Iraq","üáÆüá∂"],
  ["Ireland","üáÆüá™"],
  ["Israel","üáÆüá±"],
  ["Italy","üáÆüáπ"],
  ["Jamaica","üáØüá≤"],
  ["Japan","üáØüáµ"],
  ["Jordan","üáØüá¥"],
  ["Kazakhstan","üá∞üáø"],
  ["Kenya","üá∞üá™"],
  ["Kiribati","üá∞üáÆ"],
  ["Kuwait","üá∞üáº"],
  ["Kyrgyzstan","üá∞üá¨"],
  ["Laos","üá±üá¶"],
  ["Latvia","üá±üáª"],
  ["Lebanon","üá±üáß"],
  ["Lesotho","üá±üá∏"],
  ["Liberia","üá±üá∑"],
  ["Libya","üá±üáæ"],
  ["Liechtenstein","üá±üáÆ"],
  ["Lithuania","üá±üáπ"],
  ["Luxembourg","üá±üá∫"],
  ["Madagascar","üá≤üá¨"],
  ["Malawi","üá≤üáº"],
  ["Malaysia","üá≤üáæ"],
  ["Maldives","üá≤üáª"],
  ["Mali","üá≤üá±"],
  ["Malta","üá≤üáπ"],
  ["Marshall Islands","üá≤üá≠"],
  ["Mauritania","üá≤üá∑"],
  ["Mauritius","üá≤üá∫"],
  ["Mexico","üá≤üáΩ"],
  ["Micronesia","üá´üá≤"],
  ["Moldova","üá≤üá©"],
  ["Monaco","üá≤üá®"],
  ["Mongolia","üá≤üá≥"],
  ["Montenegro","üá≤üá™"],
  ["Morocco","üá≤üá¶"],
  ["Mozambique","üá≤üáø"],
  ["Myanmar (Burma)","üá≤üá≤"],
  ["Namibia","üá≥üá¶"],
  ["Nauru","üá≥üá∑"],
  ["Nepal","üá≥üáµ"],
  ["Netherlands","üá≥üá±"],
  ["New Zealand","üá≥üáø"],
  ["Nicaragua","üá≥üáÆ"],
  ["Niger","üá≥üá™"],
  ["Nigeria","üá≥üá¨"],
  ["North Korea","üá∞üáµ"],
  ["North Macedonia","üá≤üá∞"],
  ["Norway","üá≥üá¥"],
  ["Oman","üá¥üá≤"],
  ["Pakistan","üáµüá∞"],
  ["Palau","üáµüáº"],
  ["Palestine","üáµüá∏"],
  ["Panama","üáµüá¶"],
  ["Papua New Guinea","üáµüá¨"],
  ["Paraguay","üáµüáæ"],
  ["Peru","üáµüá™"],
  ["Philippines","üáµüá≠"],
  ["Poland","üáµüá±"],
  ["Portugal","üáµüáπ"],
  ["Qatar","üá∂üá¶"],
  ["Romania","üá∑üá¥"],
  ["Russia","üá∑üá∫"],
  ["Rwanda","üá∑üáº"],
  ["Saint Kitts and Nevis","üá∞üá≥"],
  ["Saint Lucia","üá±üá®"],
  ["Saint Vincent and the Grenadines","üáªüá®"],
  ["Samoa","üáºüá∏"],
  ["San Marino","üá∏üá≤"],
  ["Sao Tome and Principe","üá∏üáπ"],
  ["Saudi Arabia","üá∏üá¶"],
  ["Senegal","üá∏üá≥"],
  ["Serbia","üá∑üá∏"],
  ["Seychelles","üá∏üá®"],
  ["Sierra Leone","üá∏üá±"],
  ["Singapore","üá∏üá¨"],
  ["Slovakia","üá∏üá∞"],
  ["Slovenia","üá∏üáÆ"],
  ["Solomon Islands","üá∏üáß"],
  ["Somalia","üá∏üá¥"],
  ["South Africa","üáøüá¶"],
  ["South Korea","üá∞üá∑"],
  ["South Sudan","üá∏üá∏"],
  ["Spain","üá™üá∏"],
  ["Sri Lanka","üá±üá∞"],
  ["Sudan","üá∏üá©"],
  ["Suriname","üá∏üá∑"],
  ["Sweden","üá∏üá™"],
  ["Switzerland","üá®üá≠"],
  ["Syria","üá∏üáæ"],
  ["Tajikistan","üáπüáØ"],
  ["Tanzania","üáπüáø"],
  ["Thailand","üáπüá≠"],
  ["Timor-Leste","üáπüá±"],
  ["Togo","üáπüá¨"],
  ["Tonga","üáπüá¥"],
  ["Trinidad and Tobago","üáπüáπ"],
  ["Tunisia","üáπüá≥"],
  ["Turkey (T√ºrkiye)","üáπüá∑"],
  ["Turkmenistan","üáπüá≤"],
  ["Tuvalu","üáπüáª"],
  ["Uganda","üá∫üá¨"],
  ["Ukraine","üá∫üá¶"],
  ["United Arab Emirates","üá¶üá™"],
  ["United Kingdom","üá¨üáß"],
  ["United States of America","üá∫üá∏"],
  ["Uruguay","üá∫üáæ"],
  ["Uzbekistan","üá∫üáø"],
  ["Vanuatu","üáªüá∫"],
  ["Venezuela","üáªüá™"],
  ["Vietnam","üáªüá≥"],
  ["Yemen","üáæüá™"],
  ["Zambia","üáøüá≤"],
  ["Zimbabwe","üáøüáº"]
];

function flagToCode(flag){
  if(!flag) return "";
  return Array.from(flag).map(ch=>{
    const codePoint = ch.codePointAt(0);
    return String.fromCharCode(codePoint - 127397);
  }).join("");
}

function fillCountries(){
  countryEl.innerHTML = "";
  countries.forEach(c=>{
    const name = c[0];
    const flag = c[1];
    const o=document.createElement("option");
    o.value = flagToCode(flag);
    o.dataset.name = name;
    o.dataset.flag = flag;
    o.textContent = `${name} ${flag}`;
    countryEl.appendChild(o);
  });
}

fillLanguages();
fillCurrencies();
fillCountries();

/* restore saved selections */
const savedLang = localStorage.getItem("lang");
const savedCurrency = localStorage.getItem("currency");
const savedCountryCode = localStorage.getItem("country_code");
if(savedLang) langEl.value = savedLang;
if(savedCurrency) currencyEl.value = savedCurrency;
if(savedCountryCode) countryEl.value = savedCountryCode;

/* ---------- TRANSLATION ---------- */
const translations={
  en:{t:"Welcome",s:"Select your country, language & currency"},
  hi:{t:"‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à",s:"‡§Ö‡§™‡§®‡§æ ‡§¶‡•á‡§∂, ‡§≠‡§æ‡§∑‡§æ ‡§î‡§∞ ‡§Æ‡•Å‡§¶‡•ç‡§∞‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç"},
  de:{t:"Willkommen",s:"Land, Sprache & W√§hrung w√§hlen"},
  fr:{t:"Bienvenue",s:"Choisissez votre pays, langue et devise"},
  es:{t:"Bienvenido",s:"Selecciona tu pa√≠s, idioma y moneda"}
};

function applyTranslation(){
  const t = translations[langEl.value] || translations.en;
  title.innerText = t.t;
  subtitle.innerText = t.s;
}

langEl.onchange = applyTranslation;
applyTranslation();

/* ======================
   SAVE (REAL - SUPABASE)
====================== */
async function save(){
  if(!currentUser) return;

  const countryOpt = countryEl.options[countryEl.selectedIndex];
  const countryName = countryOpt?.dataset?.name || countryOpt?.textContent || "";

  localStorage.setItem("country_code", countryEl.value || "");
  localStorage.setItem("country", countryName);
  localStorage.setItem("currency", currencyEl.value || "USD");
  localStorage.setItem("lang", langEl.value || "en");
  localStorage.setItem("onboarded", "1");

  location.href="index.html";
}
</script>

</body>
</html>
