<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>F-Account Hub</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="global.js"></script>
<script src="public-config.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap">
<link rel="stylesheet" href="f-account-theme.css">
</head>
<body>
<div class="top">
  <b>F-Account Hub</b>
  <div class="top-actions">
    <button class="btn dark" type="button" onclick="location.href='index.html'">Home</button>
    <button class="btn brand" type="button" onclick="location.href='food-auto.html'">Services</button>
  </div>
</div>

<div class="wrap">
  <section class="hero">
    <b>Choose account type and create role on dedicated page</b>
    <p>Customer role is free. Driver, Seller and Agent roles need one-time INR 500 listing fee with 10% monthly platform share.</p>
    <div class="hero-pills">
      <span class="pill">No single-page overload</span>
      <span class="pill">Role-specific onboarding</span>
      <span class="pill">Live GPS for provider roles</span>
      <span class="pill">Razorpay payment for provider roles</span>
    </div>
  </section>

  <div class="layout">
    <div>
      <section class="card">
        <div class="title"><b>Create New Account</b><span class="tag">4 Role Options</span></div>
        <div class="role-grid" style="margin-top:10px">
          <div class="role-card">
            <b>I am Customer</b>
            <div class="muted">Free account for ride booking, food orders and service booking.</div>
            <button class="btn brand full" style="margin-top:10px" type="button" onclick="location.href='F-account-customer.html'">Create Customer Account</button>
          </div>
          <div class="role-card">
            <b>Become Driver</b>
            <div class="muted">OTP + live GPS + INR 500 listing fee. Ride requests and live tracking enabled.</div>
            <button class="btn brand full" style="margin-top:10px" type="button" onclick="location.href='F-account-driver.html'">Create Driver Account</button>
          </div>
          <div class="role-card">
            <b>Become Seller</b>
            <div class="muted">Food or grocery seller with unlimited listing and shop live location.</div>
            <button class="btn brand full" style="margin-top:10px" type="button" onclick="location.href='F-account-seller.html'">Create Seller Account</button>
          </div>
          <div class="role-card">
            <b>Become Agent</b>
            <div class="muted">Urban service profile with category, pricing, radius and availability.</div>
            <button class="btn brand full" style="margin-top:10px" type="button" onclick="location.href='F-account-agent.html'">Create Agent Account</button>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="title"><b>Pricing Policy</b><span class="tag">Fixed Rules</span></div>
        <div class="list">
          <div class="list-row"><b>Customer</b><span>INR 0 account fee</span></div>
          <div class="list-row"><b>Driver / Seller / Agent</b><span>INR 500 one-time listing fee via Razorpay</span></div>
          <div class="list-row"><b>Provider monthly platform share</b><span>10% of monthly completed sales or service revenue</span></div>
        </div>
      </section>
    </div>

    <aside>
      <section class="card">
        <div class="title"><b>Signed-In User</b><span class="tag">Session</span></div>
        <div id="who" class="muted" style="margin-top:8px">Checking login...</div>
        <div class="quick">
          <span class="chip">Customer free</span>
          <span class="chip">No hidden fee for booking</span>
          <span class="chip">Provider onboarding split pages</span>
        </div>
      </section>

      <section class="card">
        <div class="title"><b>Active Roles</b><span class="tag">Live</span></div>
        <div id="rolesStatus" class="status" style="margin-top:8px">Loading...</div>
        <div id="rolesList" class="list"></div>
        <button id="refreshRolesBtn" class="btn soft full" style="margin-top:8px" type="button">Refresh Roles</button>
      </section>

      <section class="card">
        <div class="title"><b>Dashboards</b><span class="tag">Operations</span></div>
        <div class="grid-2" style="margin-top:8px">
          <button class="btn brand" type="button" onclick="location.href='local-rider.html'">Driver Panel</button>
          <button class="btn brand" type="button" onclick="location.href='local-seller.html'">Seller Panel</button>
          <button class="btn brand" type="button" onclick="location.href='local-agent.html'">Agent Panel</button>
          <button class="btn dark" type="button" onclick="location.href='food-auto.html'">Open Services</button>
        </div>
      </section>
    </aside>
  </div>
</div>

<script src="f-account-core.js"></script>
<script>
const q = (id) => document.getElementById(id);

function renderRoles(rows){
  const list = q("rolesList");
  list.innerHTML = "";
  if(!Array.isArray(rows) || !rows.length){
    q("rolesStatus").textContent = "No active role yet";
    return;
  }
  q("rolesStatus").textContent = `${rows.length} active role(s)`;
  rows.forEach((row) => {
    const box = document.createElement("div");
    box.className = "list-row";
    const role = FAccountCore.roleLabel(String(row?.role || ""));
    const status = String(row?.status || "active");
    const phone = String(row?.phone || "").trim();
    box.innerHTML = `<b>${role}</b><span>Status: ${status}${phone ? ` | Phone: ${phone}` : ""}</span>`;
    list.appendChild(box);
  });
}

async function loadRoles(){
  const user = await FAccountCore.getSessionUser(true);
  if(!user){
    q("who").textContent = "Not logged in";
    q("rolesStatus").className = "status bad";
    q("rolesStatus").textContent = "Login required to read role status";
    q("rolesList").innerHTML = "";
    return;
  }
  q("who").textContent = `${user.email || "Logged in"} (${user.id})`;
  q("rolesStatus").className = "status";
  q("rolesStatus").textContent = "Loading roles...";
  const out = await FAccountCore.loadRoles(user.id);
  if(!out?.ok){
    q("rolesStatus").className = "status bad";
    q("rolesStatus").textContent = `Unable to load roles: ${String(out?.error || "api_failed")}`;
    q("rolesList").innerHTML = "";
    return;
  }
  q("rolesStatus").className = "status ok";
  renderRoles(Array.isArray(out.roles) ? out.roles : []);
}

q("refreshRolesBtn").onclick = () => loadRoles().catch(() => {});
loadRoles().catch(() => {});
</script>
</body>
</html>
