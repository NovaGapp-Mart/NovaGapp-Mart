<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Welcome | NOVAGAPP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="public-config.js"></script>
<script src="global.js"></script>

<style>
:root{
  --orange:#ff7a00;
  --bg:#0d0f14;
  --card:#151925;
  --text:#fff;
  --muted:#9aa4bf;
}
body{
  margin:0;
  background:var(--bg);
  font-family:Arial,system-ui;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  width:100%;
  max-width:460px;
  background:var(--card);
  padding:28px;
  border-radius:16px;
}
h2{color:var(--text);margin:0 0 8px}
p{color:var(--muted);margin:0 0 18px}
.section-label{
  color:#c9d2ee;
  font-size:13px;
  font-weight:600;
  margin-top:14px;
  display:block;
}
select,button{
  width:100%;
  padding:14px;
  border-radius:12px;
  margin-top:10px;
  border:none;
  font-size:15px;
}
select{background:#0f1220;color:#fff}
button{
  background:var(--orange);
  color:#fff;
  font-weight:600;
  margin-top:18px;
}
</style>
</head>

<body>

<div class="card">
  <h2 id="title">Welcome</h2>
  <p id="subtitle">Choose your country, language and currency</p>

  <label class="section-label" for="lang">Language</label>
  <select id="lang"></select>

  <label class="section-label" for="currency">Currency</label>
  <select id="currency"></select>

  <label class="section-label" for="country">Country</label>
  <select id="country"></select>

  <button onclick="save()">Continue</button>
</div>

<script>
window.supa = window.supa || window.novaCreateSupabaseClient({
  auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
});

let currentUser = null;
const supa = window.supa;
if(!supa){
  location.href = "login.html";
  throw new Error("supabase_client_unavailable");
}

/* ======================
   AUTH CHECK
====================== */
(async ()=>{
  const { data } = await supa.auth.getUser();
  if(!data?.user){
    location.href="login.html";
    return;
  }
  currentUser = data.user;
})();

const langEl = document.getElementById("lang");
const currencyEl = document.getElementById("currency");
const countryEl = document.getElementById("country");

/* ---------- LANGUAGES ---------- */
const globalLanguages = [
  ["en","English"],
  ["zh","Mandarin Chinese"],
  ["es","Spanish"],
  ["ar","Arabic"],
  ["fr","French"],
  ["de","German"],
  ["pt","Portuguese"],
  ["ru","Russian"],
  ["ja","Japanese"],
  ["ko","Korean"],
  ["it","Italian"],
  ["tr","Turkish"],
  ["id","Indonesian"],
  ["th","Thai"],
  ["vi","Vietnamese"]
];

const indianLanguages = [
  ["as","Assamese"],
  ["bn","Bengali"],
  ["brx","Bodo"],
  ["doi","Dogri"],
  ["gu","Gujarati"],
  ["hi","Hindi"],
  ["kn","Kannada"],
  ["ks","Kashmiri"],
  ["kok","Konkani"],
  ["mai","Maithili"],
  ["ml","Malayalam"],
  ["mni","Manipuri (Meitei)"],
  ["mr","Marathi"],
  ["ne","Nepali"],
  ["or","Odia"],
  ["pa","Punjabi"],
  ["sa","Sanskrit"],
  ["sat","Santali"],
  ["sd","Sindhi"],
  ["ta","Tamil"],
  ["te","Telugu"],
  ["ur","Urdu"]
];

function fillLanguages(){
  langEl.innerHTML = "";
  const g1 = document.createElement("optgroup");
  g1.label = "Global Languages";
  globalLanguages.forEach(l=>{
    const o=document.createElement("option");
    o.value=l[0];
    o.textContent=l[1];
    g1.appendChild(o);
  });
  const g2 = document.createElement("optgroup");
  g2.label = "Indian Languages (22 Scheduled)";
  indianLanguages.forEach(l=>{
    const o=document.createElement("option");
    o.value=l[0];
    o.textContent=l[1];
    g2.appendChild(o);
  });
  langEl.appendChild(g1);
  langEl.appendChild(g2);
}

/* ---------- CURRENCIES ---------- */
const currencies = [
  ["USD","US Dollar (USD)"],
  ["EUR","Euro (EUR)"],
  ["GBP","British Pound (GBP)"],
  ["JPY","Japanese Yen (JPY)"],
  ["CNY","Chinese Yuan (CNY)"],
  ["CHF","Swiss Franc (CHF)"],
  ["CAD","Canadian Dollar (CAD)"],
  ["AUD","Australian Dollar (AUD)"],
  ["SGD","Singapore Dollar (SGD)"],
  ["HKD","Hong Kong Dollar (HKD)"],
  ["KRW","South Korean Won (KRW)"],
  ["SAR","Saudi Riyal (SAR)"],
  ["AED","UAE Dirham (AED)"],
  ["NOK","Norwegian Krone (NOK)"],
  ["SEK","Swedish Krona (SEK)"],
  ["INR","Indian Rupee (INR)"]
];

function fillCurrencies(){
  currencyEl.innerHTML = "";
  currencies.forEach(c=>{
    const o=document.createElement("option");
    o.value=c[0];
    o.textContent=c[1];
    currencyEl.appendChild(o);
  });
}

/* ---------- COUNTRIES ---------- */
const countries = [
  ["Afghanistan","ðŸ‡¦ðŸ‡«"],
  ["Albania","ðŸ‡¦ðŸ‡±"],
  ["Algeria","ðŸ‡©ðŸ‡¿"],
  ["Andorra","ðŸ‡¦ðŸ‡©"],
  ["Angola","ðŸ‡¦ðŸ‡´"],
  ["Antigua and Barbuda","ðŸ‡¦ðŸ‡¬"],
  ["Argentina","ðŸ‡¦ðŸ‡·"],
  ["Armenia","ðŸ‡¦ðŸ‡²"],
  ["Australia","ðŸ‡¦ðŸ‡º"],
  ["Austria","ðŸ‡¦ðŸ‡¹"],
  ["Azerbaijan","ðŸ‡¦ðŸ‡¿"],
  ["Bahamas","ðŸ‡§ðŸ‡¸"],
  ["Bahrain","ðŸ‡§ðŸ‡­"],
  ["Bangladesh","ðŸ‡§ðŸ‡©"],
  ["Barbados","ðŸ‡§ðŸ‡§"],
  ["Belarus","ðŸ‡§ðŸ‡¾"],
  ["Belgium","ðŸ‡§ðŸ‡ª"],
  ["Belize","ðŸ‡§ðŸ‡¿"],
  ["Benin","ðŸ‡§ðŸ‡¯"],
  ["Bhutan","ðŸ‡§ðŸ‡¹"],
  ["Bolivia","ðŸ‡§ðŸ‡´"],
  ["Bosnia and Herzegovina","ðŸ‡§ðŸ‡¦"],
  ["Botswana","ðŸ‡§ðŸ‡¼"],
  ["Brazil","ðŸ‡§ðŸ‡·"],
  ["Brunei","ðŸ‡§ðŸ‡³"],
  ["Bulgaria","ðŸ‡§ðŸ‡¬"],
  ["Burkina Faso","ðŸ‡§ðŸ‡«"],
  ["Burundi","ðŸ‡§ðŸ‡®"],
  ["Cabo Verde","ðŸ‡¨ðŸ‡»"],
  ["Cambodia","ðŸ‡°ðŸ‡­"],
  ["Cameroon","ðŸ‡¨ðŸ‡²"],
  ["Canada","ðŸ‡¨ðŸ‡¦"],
  ["Central African Republic","ðŸ‡¨ðŸ‡«"],
  ["Chad","ðŸ‡¹ðŸ‡©"],
  ["Chile","ðŸ‡¨ðŸ‡±"],
  ["China","ðŸ‡¨ðŸ‡³"],
  ["Colombia","ðŸ‡¨ðŸ‡´"],
  ["Comoros","ðŸ‡°ðŸ‡²"],
  ["Congo (Congo-Brazzaville)","ðŸ‡¨ðŸ‡¬"],
  ["Costa Rica","ðŸ‡¨ðŸ‡·"],
  ["Croatia","ðŸ‡­ðŸ‡·"],
  ["Cuba","ðŸ‡¨ðŸ‡º"],
  ["Cyprus","ðŸ‡¨ðŸ‡¾"],
  ["Czechia (Czech Republic)","ðŸ‡¨ðŸ‡¿"],
  ["Democratic Republic of Congo","ðŸ‡¨ðŸ‡©"],
  ["Denmark","ðŸ‡©ðŸ‡°"],
  ["Djibouti","ðŸ‡©ðŸ‡¯"],
  ["Dominica","ðŸ‡©ðŸ‡²"],
  ["Dominican Republic","ðŸ‡©ðŸ‡´"],
  ["Ecuador","ðŸ‡ªðŸ‡¨"],
  ["Egypt","ðŸ‡ªðŸ‡¬"],
  ["El Salvador","ðŸ‡¸ðŸ‡»"],
  ["Equatorial Guinea","ðŸ‡¬ðŸ‡¶"],
  ["Eritrea","ðŸ‡ªðŸ‡·"],
  ["Estonia","ðŸ‡ªðŸ‡ª"],
  ["Eswatini","ðŸ‡¸ðŸ‡¿"],
  ["Ethiopia","ðŸ‡ªðŸ‡¹"],
  ["Fiji","ðŸ‡«ðŸ‡¯"],
  ["Finland","ðŸ‡«ðŸ‡®"],
  ["France","ðŸ‡«ðŸ‡·"],
  ["Gabon","ðŸ‡¬ðŸ‡¦"],
  ["Gambia","ðŸ‡¬ðŸ‡²"],
  ["Georgia","ðŸ‡¬ðŸ‡ª"],
  ["Germany","ðŸ‡©ðŸ‡ª"],
  ["Ghana","ðŸ‡¬ðŸ‡­"],
  ["Greece","ðŸ‡¬ðŸ‡·"],
  ["Grenada","ðŸ‡¬ðŸ‡©"],
  ["Guatemala","ðŸ‡¬ðŸ‡¹"],
  ["Guinea","ðŸ‡¬ðŸ‡³"],
  ["Guinea-Bissau","ðŸ‡¬ðŸ‡¼"],
  ["Guyana","ðŸ‡¬ðŸ‡¾"],
  ["Haiti","ðŸ‡­ðŸ‡¹"],
  ["Holy See (Vatican City)","ðŸ‡»ðŸ‡¦"],
  ["Honduras","ðŸ‡­ðŸ‡³"],
  ["Hungary","ðŸ‡­ðŸ‡º"],
  ["Iceland","ðŸ‡®ðŸ‡¸"],
  ["India","ðŸ‡®ðŸ‡³"],
  ["Indonesia","ðŸ‡®ðŸ‡©"],
  ["Iran","ðŸ‡®ðŸ‡·"],
  ["Iraq","ðŸ‡®ðŸ‡¶"],
  ["Ireland","ðŸ‡®ðŸ‡ª"],
  ["Israel","ðŸ‡®ðŸ‡±"],
  ["Italy","ðŸ‡®ðŸ‡¹"],
  ["Jamaica","ðŸ‡¯ðŸ‡²"],
  ["Japan","ðŸ‡¯ðŸ‡µ"],
  ["Jordan","ðŸ‡¯ðŸ‡´"],
  ["Kazakhstan","ðŸ‡°ðŸ‡¿"],
  ["Kenya","ðŸ‡°ðŸ‡ª"],
  ["Kiribati","ðŸ‡°ðŸ‡®"],
  ["Kuwait","ðŸ‡°ðŸ‡¼"],
  ["Kyrgyzstan","ðŸ‡°ðŸ‡¬"],
  ["Laos","ðŸ‡±ðŸ‡¦"],
  ["Latvia","ðŸ‡±ðŸ‡»"],
  ["Lebanon","ðŸ‡±ðŸ‡§"],
  ["Lesotho","ðŸ‡±ðŸ‡¸"],
  ["Liberia","ðŸ‡±ðŸ‡·"],
  ["Libya","ðŸ‡±ðŸ‡¾"],
  ["Liechtenstein","ðŸ‡±ðŸ‡®"],
  ["Lithuania","ðŸ‡±ðŸ‡¹"],
  ["Luxembourg","ðŸ‡±ðŸ‡º"],
  ["Madagascar","ðŸ‡²ðŸ‡¬"],
  ["Malawi","ðŸ‡²ðŸ‡¼"],
  ["Malaysia","ðŸ‡²ðŸ‡¾"],
  ["Maldives","ðŸ‡²ðŸ‡»"],
  ["Mali","ðŸ‡²ðŸ‡±"],
  ["Malta","ðŸ‡²ðŸ‡¹"],
  ["Marshall Islands","ðŸ‡²ðŸ‡­"],
  ["Mauritania","ðŸ‡²ðŸ‡·"],
  ["Mauritius","ðŸ‡²ðŸ‡º"],
  ["Mexico","ðŸ‡²ðŸ‡½"],
  ["Micronesia","ðŸ‡«ðŸ‡²"],
  ["Moldova","ðŸ‡²ðŸ‡©"],
  ["Monaco","ðŸ‡²ðŸ‡¨"],
  ["Mongolia","ðŸ‡²ðŸ‡³"],
  ["Montenegro","ðŸ‡²ðŸ‡ª"],
  ["Morocco","ðŸ‡²ðŸ‡¦"],
  ["Mozambique","ðŸ‡²ðŸ‡¿"],
  ["Myanmar (Burma)","ðŸ‡²ðŸ‡²"],
  ["Namibia","ðŸ‡³ðŸ‡¦"],
  ["Nauru","ðŸ‡³ðŸ‡·"],
  ["Nepal","ðŸ‡³ðŸ‡µ"],
  ["Netherlands","ðŸ‡³ðŸ‡±"],
  ["New Zealand","ðŸ‡³ðŸ‡¿"],
  ["Nicaragua","ðŸ‡³ðŸ‡®"],
  ["Niger","ðŸ‡³ðŸ‡ª"],
  ["Nigeria","ðŸ‡³ðŸ‡¬"],
  ["North Korea","ðŸ‡°ðŸ‡µ"],
  ["North Macedonia","ðŸ‡²ðŸ‡°"],
  ["Norway","ðŸ‡³ðŸ‡´"],
  ["Oman","ðŸ‡´ðŸ‡²"],
  ["Pakistan","ðŸ‡µðŸ‡°"],
  ["Palau","ðŸ‡µðŸ‡¼"],
  ["Palestine","ðŸ‡µðŸ‡¸"],
  ["Panama","ðŸ‡µðŸ‡¦"],
  ["Papua New Guinea","ðŸ‡µðŸ‡¬"],
  ["Paraguay","ðŸ‡µðŸ‡¾"],
  ["Peru","ðŸ‡µðŸ‡ª"],
  ["Philippines","ðŸ‡µðŸ‡­"],
  ["Poland","ðŸ‡µðŸ‡±"],
  ["Portugal","ðŸ‡µðŸ‡¹"],
  ["Qatar","ðŸ‡¶ðŸ‡¦"],
  ["Romania","ðŸ‡·ðŸ‡´"],
  ["Russia","ðŸ‡·ðŸ‡º"],
  ["Rwanda","ðŸ‡·ðŸ‡¼"],
  ["Saint Kitts and Nevis","ðŸ‡°ðŸ‡³"],
  ["Saint Lucia","ðŸ‡±ðŸ‡¨"],
  ["Saint Vincent and the Grenadines","ðŸ‡»ðŸ‡¨"],
  ["Samoa","ðŸ‡¼ðŸ‡¸"],
  ["San Marino","ðŸ‡¸ðŸ‡²"],
  ["Sao Tome and Principe","ðŸ‡¸ðŸ‡¹"],
  ["Saudi Arabia","ðŸ‡¸ðŸ‡¦"],
  ["Senegal","ðŸ‡¸ðŸ‡³"],
  ["Serbia","ðŸ‡·ðŸ‡¸"],
  ["Seychelles","ðŸ‡¸ðŸ‡¨"],
  ["Sierra Leone","ðŸ‡¸ðŸ‡±"],
  ["Singapore","ðŸ‡¸ðŸ‡¬"],
  ["Slovakia","ðŸ‡¸ðŸ‡°"],
  ["Slovenia","ðŸ‡¸ðŸ‡®"],
  ["Solomon Islands","ðŸ‡¸ðŸ‡§"],
  ["Somalia","ðŸ‡¸ðŸ‡´"],
  ["South Africa","ðŸ‡¿ðŸ‡¦"],
  ["South Korea","ðŸ‡°ðŸ‡·"],
  ["South Sudan","ðŸ‡¸ðŸ‡¸"],
  ["Spain","ðŸ‡ªðŸ‡¸"],
  ["Sri Lanka","ðŸ‡±ðŸ‡°"],
  ["Sudan","ðŸ‡¸ðŸ‡©"],
  ["Suriname","ðŸ‡¸ðŸ‡·"],
  ["Sweden","ðŸ‡¸ðŸ‡ª"],
  ["Switzerland","ðŸ‡¨ðŸ‡­"],
  ["Syria","ðŸ‡¸ðŸ‡¾"],
  ["Tajikistan","ðŸ‡¹ðŸ‡¯"],
  ["Tanzania","ðŸ‡¹ðŸ‡¿"],
  ["Thailand","ðŸ‡¹ðŸ‡­"],
  ["Timor-Leste","ðŸ‡¹ðŸ‡±"],
  ["Togo","ðŸ‡¹ðŸ‡¬"],
  ["Tonga","ðŸ‡¹ðŸ‡´"],
  ["Trinidad and Tobago","ðŸ‡¹ðŸ‡¹"],
  ["Tunisia","ðŸ‡¹ðŸ‡³"],
  ["Turkey (TÃ¼rkiye)","ðŸ‡¹ðŸ‡·"],
  ["Turkmenistan","ðŸ‡¹ðŸ‡²"],
  ["Tuvalu","ðŸ‡¹ðŸ‡»"],
  ["Uganda","ðŸ‡ºðŸ‡¬"],
  ["Ukraine","ðŸ‡ºðŸ‡¦"],
  ["United Arab Emirates","ðŸ‡¦ðŸ‡ª"],
  ["United Kingdom","ðŸ‡¬ðŸ‡§"],
  ["United States of America","ðŸ‡ºðŸ‡¸"],
  ["Uruguay","ðŸ‡ºðŸ‡¾"],
  ["Uzbekistan","ðŸ‡ºðŸ‡¿"],
  ["Vanuatu","ðŸ‡»ðŸ‡º"],
  ["Venezuela","ðŸ‡»ðŸ‡ª"],
  ["Vietnam","ðŸ‡»ðŸ‡³"],
  ["Yemen","ðŸ‡¾ðŸ‡ª"],
  ["Zambia","ðŸ‡¿ðŸ‡²"],
  ["Zimbabwe","ðŸ‡¿ðŸ‡¼"]
];

function flagToCode(flag){
  if(!flag) return "";
  return Array.from(flag).map(ch=>{
    const codePoint = ch.codePointAt(0);
    return String.fromCharCode(codePoint - 127397);
  }).join("");
}

function fillCountries(){
  countryEl.innerHTML = "";
  countries.forEach(c=>{
    const name = c[0];
    const flag = c[1];
    const o=document.createElement("option");
    o.value = flagToCode(flag);
    o.dataset.name = name;
    o.dataset.flag = flag;
    o.textContent = `${name} ${flag}`;
    countryEl.appendChild(o);
  });
}

fillLanguages();
fillCurrencies();
fillCountries();

/* restore saved selections */
const savedLang = localStorage.getItem("lang");
const savedCurrency = localStorage.getItem("currency");
const savedCountryCode = localStorage.getItem("country_code");
if(savedLang) langEl.value = savedLang;
if(savedCurrency) currencyEl.value = savedCurrency;
if(savedCountryCode) countryEl.value = savedCountryCode;

/* ======================
   SAVE
====================== */
async function save(){
  if(!currentUser) return;
  const countryOpt = countryEl.options[countryEl.selectedIndex];
  const countryName = countryOpt?.dataset?.name || countryOpt?.textContent || "";
  localStorage.setItem("country_code", countryEl.value || "");
  localStorage.setItem("country", countryName);
  localStorage.setItem("currency", currencyEl.value || "USD");
  localStorage.setItem("lang", langEl.value || "en");
  localStorage.setItem("onboarded", "1");
  location.href="index.html";
}
</script>

</body>
</html>
